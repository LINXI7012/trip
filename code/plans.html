<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Plans - DeepTrip</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/plans.css">
    <link rel="stylesheet" href="css/travel-guide-details.css">
    <link rel="stylesheet" href="css/travel-guide-journal-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/airplane-cursor.css">
</head>
<body class="plans-page">
    <div class="fullscreen-bg"></div>
    
    <nav class="side-nav">
        <ul>
            <li><a href="create.html" class="nav-item">Create</a></li>
            <li><a href="explore.html" class="nav-item">Explore</a></li>
            <li><a href="personal.html" class="nav-item">Personal</a></li>
            <li><a href="plans.html" class="nav-item">Plans</a></li>
        </ul>
    </nav>
    
    <a href="index.html" class="back-nav">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 12H19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 5L5 12L12 19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </a>
    
    <main class="content">
        <div class="plans-header">
            <h1 class="page-title">Your Travel Plans</h1>
            <a href="create.html" class="btn btn-primary add-plan-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                ÂàõÂª∫Êñ∞ÊóÖÁ®ã
            </a>
        </div>
        
        <div class="journal-container">
            <div class="journal-left">
                <div class="plan-details-content">
                    <!-- Plan details will be populated by JavaScript -->
                    <div class="empty-state">
                        <div class="empty-icon">‚úàÔ∏è</div>
                        <h3>ÈÄâÊã©‰∏Ä‰∏™ÊóÖË°åËÆ°Âàí</h3>
                        <p>ËØ∑Âú®Âè≥‰æßÂàóË°®‰∏≠ÈÄâÊã©‰∏Ä‰∏™ÊóÖË°åËÆ°ÂàíÊü•ÁúãËØ¶ÊÉÖ</p>
                    </div>
                </div>
            </div>
            <div class="journal-right">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="upcoming">Upcoming</button>
                    <button class="tab-btn" data-tab="past">Past</button>
                    <button class="tab-btn" data-tab="drafts">Drafts</button>
                </div>
                
                <div class="tab-content active" data-tab-content="upcoming">
                    <div class="plans-container">
                        <!-- Plans will be populated by JavaScript -->
                        <div class="empty-state">
                            <div class="empty-icon">‚úàÔ∏è</div>
                            <h3>ÊöÇÊó†ÊóÖË°åËÆ°Âàí</h3>
                            <p>ÈÄöËøáÈóÆÂç∑ÁîüÊàêÊàñ‰ªéÊé¢Á¥¢ÁïåÈù¢Êî∂ËóèÁöÑÊîªÁï•Â∞ÜÊòæÁ§∫Âú®ËøôÈáå</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" data-tab-content="past">
                    <div class="empty-state">
                        <div class="empty-icon">üèÜ</div>
                        <h3>Trip History</h3>
                        <p>Completed trips will appear here</p>
                    </div>
                </div>
                
                <div class="tab-content" data-tab-content="drafts">
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <h3>Trip Drafts</h3>
                        <p>Save trip ideas and continue planning later</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="trip-details-modal">
            <div class="modal-header">
                <h2 class="modal-title">Kyoto Trip</h2>
                <button class="modal-close">√ó</button>
            </div>
            
            <div class="modal-content">
                <div class="trip-info">
                    <div class="trip-dates">
                        <div class="date-item">
                            <div class="date-label">Departure</div>
                            <div class="date-value">Nov 10, 2024</div>
                        </div>
                        <div class="date-separator"></div>
                        <div class="date-item">
                            <div class="date-label">Return</div>
                            <div class="date-value">Nov 17, 2024</div>
                        </div>
                    </div>
                    
                    <div class="trip-meta">
                        <div class="meta-item">
                            <div class="meta-icon">üë•</div>
                            <div class="meta-text">2 Travelers</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-icon">üí∞</div>
                            <div class="meta-text">$2,400 Budget</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-icon">üå°Ô∏è</div>
                            <div class="meta-text">15-20¬∞C</div>
                        </div>
                    </div>
                </div>
                
                <div class="trip-sections">
                    <div class="section-tabs">
                        <button class="section-tab active" data-section="timeline">Timeline</button>
                        <button class="section-tab" data-section="packing">Packing List</button>
                        <button class="section-tab" data-section="budget">Budget</button>
                        <button class="section-tab" data-section="contacts">Contacts</button>
                    </div>
                    
                    <div class="section-content active" data-section-content="timeline">
                        <div class="timeline-container">
                            <div class="day-timeline">
                                <div class="timeline-day-header">
                                    <div class="day-number">Day 1</div>
                                    <div class="day-title">Arrival & Settling In</div>
                                    <div class="day-date">Nov 10</div>
                                </div>
                                <div class="timeline-items">
                                    <div class="timeline-item">
                                        <div class="timeline-time">14:30</div>
                                        <div class="timeline-content">
                                            <div class="timeline-title">Arrive at Kansai International Airport</div>
                                            <div class="timeline-notes">Terminal 1, JAL Flight 123</div>
                                        </div>
                                    </div>
                                    <div class="timeline-item">
                                        <div class="timeline-time">16:00</div>
                                        <div class="timeline-content">
                                            <div class="timeline-title">Check-in at Ryokan Sakura</div>
                                            <div class="timeline-notes">Traditional Japanese inn with onsen</div>
                                        </div>
                                    </div>
                                    <div class="timeline-item">
                                        <div class="timeline-time">18:30</div>
                                        <div class="timeline-content">
                                            <div class="timeline-title">Dinner at Pontocho Alley</div>
                                            <div class="timeline-notes">Traditional Kyoto cuisine</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="day-timeline">
                                <div class="timeline-day-header">
                                    <div class="day-number">Day 2</div>
                                    <div class="day-title">Eastern Kyoto</div>
                                    <div class="day-date">Nov 11</div>
                                </div>
                                <div class="timeline-items">
                                    <div class="timeline-item">
                                        <div class="timeline-time">09:00</div>
                                        <div class="timeline-content">
                                            <div class="timeline-title">Visit Kiyomizu-dera Temple</div>
                                            <div class="timeline-notes">UNESCO World Heritage site with beautiful views</div>
                                        </div>
                                    </div>
                                    <div class="timeline-item">
                                        <div class="timeline-time">12:30</div>
                                        <div class="timeline-content">
                                            <div class="timeline-title">Lunch at Ninen-zaka</div>
                                            <div class="timeline-notes">Traditional teahouses and cafes</div>
                                        </div>
                                    </div>
                                    <div class="timeline-item">
                                        <div class="timeline-time">14:00</div>
                                        <div class="timeline-content">
                                            <div class="timeline-title">Explore Gion District</div>
                                            <div class="timeline-notes">Historic geisha district</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-outline btn-small show-more-days">View All 7 Days</button>
                        </div>
                    </div>
                    
                    <div class="section-content" data-section-content="packing">
                        <div class="packing-list-container">
                            <div class="packing-category">
                                <div class="category-header">
                                    <h3>Essentials</h3>
                                    <div class="category-progress">3/5</div>
                                </div>
                                <ul class="packing-items">
                                    <li class="packing-item checked">
                                        <label class="item-checkbox">
                                            <input type="checkbox" checked>
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Passport</span>
                                    </li>
                                    <li class="packing-item checked">
                                        <label class="item-checkbox">
                                            <input type="checkbox" checked>
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Travel Insurance</span>
                                    </li>
                                    <li class="packing-item checked">
                                        <label class="item-checkbox">
                                            <input type="checkbox" checked>
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Flight Tickets</span>
                                    </li>
                                    <li class="packing-item">
                                        <label class="item-checkbox">
                                            <input type="checkbox">
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Credit Cards</span>
                                    </li>
                                    <li class="packing-item">
                                        <label class="item-checkbox">
                                            <input type="checkbox">
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Japanese Yen</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="packing-category">
                                <div class="category-header">
                                    <h3>Clothing</h3>
                                    <div class="category-progress">2/7</div>
                                </div>
                                <ul class="packing-items">
                                    <li class="packing-item checked">
                                        <label class="item-checkbox">
                                            <input type="checkbox" checked>
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Light Jacket</span>
                                    </li>
                                    <li class="packing-item checked">
                                        <label class="item-checkbox">
                                            <input type="checkbox" checked>
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Comfortable Walking Shoes</span>
                                    </li>
                                    <li class="packing-item">
                                        <label class="item-checkbox">
                                            <input type="checkbox">
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Socks (7 pairs)</span>
                                    </li>
                                    <li class="packing-item">
                                        <label class="item-checkbox">
                                            <input type="checkbox">
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Underwear (7 pairs)</span>
                                    </li>
                                    <li class="packing-item">
                                        <label class="item-checkbox">
                                            <input type="checkbox">
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">T-shirts (5)</span>
                                    </li>
                                    <li class="packing-item">
                                        <label class="item-checkbox">
                                            <input type="checkbox">
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Jeans/Pants (3)</span>
                                    </li>
                                    <li class="packing-item">
                                        <label class="item-checkbox">
                                            <input type="checkbox">
                                            <span class="checkmark"></span>
                                        </label>
                                        <span class="item-name">Sweater/Hoodie</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <button class="btn btn-secondary add-item-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Add Item
                            </button>
                        </div>
                    </div>
                    
                    <div class="section-content" data-section-content="budget">
                        <div class="budget-container">
                            <div class="budget-summary">
                                <div class="budget-amount">
                                    <div class="amount-label">Total Budget</div>
                                    <div class="amount-value">$2,400</div>
                                </div>
                                <div class="budget-progress">
                                    <div class="progress-info">
                                        <span>$1,850 Allocated</span>
                                        <span>$550 Unallocated</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 77%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="budget-categories">
                                <div class="budget-category">
                                    <div class="category-icon" style="background-color: rgba(255, 107, 107, 0.2);">‚úàÔ∏è</div>
                                    <div class="category-details">
                                        <div class="category-name">Flights</div>
                                        <div class="category-allocation">$800 (33%)</div>
                                    </div>
                                </div>
                                <div class="budget-category">
                                    <div class="category-icon" style="background-color: rgba(217, 179, 16, 0.2);">üè®</div>
                                    <div class="category-details">
                                        <div class="category-name">Accommodation</div>
                                        <div class="category-allocation">$600 (25%)</div>
                                    </div>
                                </div>
                                <div class="budget-category">
                                    <div class="category-icon" style="background-color: rgba(10, 35, 66, 0.2);">üç£</div>
                                    <div class="category-details">
                                        <div class="category-name">Food</div>
                                        <div class="category-allocation">$300 (12.5%)</div>
                                    </div>
                                </div>
                                <div class="budget-category">
                                    <div class="category-icon" style="background-color: rgba(61, 153, 112, 0.2);">üöÜ</div>
                                    <div class="category-details">
                                        <div class="category-name">Transportation</div>
                                        <div class="category-allocation">$150 (6.25%)</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="currency-converter">
                                <h3>Currency Converter</h3>
                                <div class="converter-inputs">
                                    <div class="converter-input">
                                        <input type="number" value="1" min="0">
                                        <select>
                                            <option value="USD" selected>USD</option>
                                            <option value="JPY">JPY</option>
                                            <option value="EUR">EUR</option>
                                            <option value="GBP">GBP</option>
                                        </select>
                                    </div>
                                    <div class="converter-equals">=</div>
                                    <div class="converter-input">
                                        <input type="number" value="142.81" disabled>
                                        <select>
                                            <option value="USD">USD</option>
                                            <option value="JPY" selected>JPY</option>
                                            <option value="EUR">EUR</option>
                                            <option value="GBP">GBP</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-content" data-section-content="contacts">
                        <div class="contacts-container">
                            <div class="emergency-contacts">
                                <h3>Emergency Contacts</h3>
                                <div class="contact-cards">
                                    <div class="contact-card">
                                        <div class="contact-icon">üö®</div>
                                        <div class="contact-details">
                                            <div class="contact-name">Emergency Services</div>
                                            <div class="contact-number">110 (Police) / 119 (Ambulance)</div>
                                        </div>
                                    </div>
                                    <div class="contact-card">
                                        <div class="contact-icon">üè•</div>
                                        <div class="contact-details">
                                            <div class="contact-name">Kyoto University Hospital</div>
                                            <div class="contact-number">+81 75-751-3111</div>
                                        </div>
                                    </div>
                                    <div class="contact-card">
                                        <div class="contact-icon">üèõÔ∏è</div>
                                        <div class="contact-details">
                                            <div class="contact-name">US Embassy in Japan</div>
                                            <div class="contact-number">+81 3-3224-5000</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accommodations-contacts">
                                <h3>Accommodation</h3>
                                <div class="contact-card">
                                    <div class="contact-icon">üè°</div>
                                    <div class="contact-details">
                                        <div class="contact-name">Ryokan Sakura</div>
                                        <div class="contact-address">123 Gion-machi, Higashiyama-ku, Kyoto</div>
                                        <div class="contact-number">+81 75-561-1234</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-outline">Share Trip</button>
                <button class="btn btn-primary">Save Changes</button>
            </div>
        </div>
        
        <div class="modal-overlay"></div>
    </main>

    <!-- Travel Guide Details Modal -->
    <div class="travel-guide-overlay"></div>
    <div class="travel-guide-modal">
        <div class="travel-guide-header">
            <h2 class="travel-guide-title">Travel Guide</h2>
            <button class="travel-guide-close">√ó</button>
        </div>
        <div class="travel-guide-content">
            <div class="travel-guide-container">
                <!-- Travel guide content will be dynamically generated -->
            </div>
        </div>
    </div>

    <!-- Edit Travel Guide Modal -->
    <div class="edit-guide-overlay"></div>
    <div class="edit-guide-modal">
        <div class="edit-guide-header">
            <h2 class="edit-guide-title">ÁºñËæëÊóÖË°åÊîªÁï•</h2>
            <button class="edit-guide-close">√ó</button>
        </div>
        <div class="edit-guide-content">
            <div class="edit-guide-container">
                <div class="edit-section">
                    <h3>Êìç‰ΩúÈÄâÈ°π</h3>
                    <div class="edit-actions">
                        <button id="deleteGuideBtn" class="btn btn-danger">Âà†Èô§ÊîªÁï•</button>
                        <button id="modifyItineraryBtn" class="btn btn-primary">‰øÆÊîπË°åÁ®ã</button>
                    </div>
                </div>
                
                <div class="day-edit-section" style="display: none;">
                    <h3>ÈÄâÊã©Ë¶Å‰øÆÊîπÁöÑË°åÁ®ãÊó•</h3>
                    <div class="day-select-container"></div>
                    <div class="form-actions">
                        <button type="button" id="backToEditBtn" class="btn btn-outline">ËøîÂõû</button>
                    </div>
                </div>
                
                <div class="day-edit-form" style="display: none;">
                    <h3>‰øÆÊîπË°åÁ®ã‰ø°ÊÅØ</h3>
                    <form>
                        <div class="form-group">
                            <label for="dayActivityInput">Ê¥ªÂä®ÂÜÖÂÆπ</label>
                            <input type="text" id="dayActivityInput" class="form-control" placeholder="ËæìÂÖ•Ê¥ªÂä®ÊèèËø∞">
                        </div>
                        <div class="form-group">
                            <label for="dayLocationInput">Ê¥ªÂä®Âú∞ÁÇπ</label>
                            <input type="text" id="dayLocationInput" class="form-control" placeholder="ËæìÂÖ•Ê¥ªÂä®Âú∞ÁÇπ">
                        </div>
                        <div class="form-actions">
                            <button type="button" id="backToDaysBtn" class="btn btn-outline">ËøîÂõû</button>
                            <button type="button" id="saveDayBtn" class="btn btn-primary">‰øùÂ≠ò‰øÆÊîπ</button>
                        </div>
                    </form>
                </div>
                
                <div class="delete-confirm-section" style="display: none;">
                    <h3>Á°ÆËÆ§Âà†Èô§</h3>
                    <p>ÊÇ®Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÊóÖË°åÊîªÁï•ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ</p>
                    <div class="confirm-actions">
                        <button id="cancelDeleteBtn" class="btn btn-outline">ÂèñÊ∂à</button>
                        <button id="confirmDeleteBtn" class="btn btn-danger">Á°ÆËÆ§Âà†Èô§</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <script src="js/html2canvas.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/airplane-cursor.js"></script>
    <script src="js/progress-editor.js"></script>
    <script src="js/plans-guide-enhancer.js"></script>
    
    <!-- Á´ãÂç≥ÊòæÁ§∫ÁúüÂÆûÊîªÁï•ÁöÑËÑöÊú¨ -->
    <script>
    (function() {
        console.log('ÂºÄÂßãÊâ´ÊèèÁúüÂÆûÊîªÁï•Êï∞ÊçÆ...');
        
        // Ê∑ªÂä†Ê†∑Âºè
        const style = document.createElement('style');
        style.textContent = `
            .plan-card {
                position: relative;
            }
            
            .delete-button {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.2);
                border: none;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                opacity: 0.7;
                backdrop-filter: blur(2px);
            }
            
            .delete-button:hover {
                background: rgba(231, 76, 60, 0.8);
                opacity: 1;
                transform: scale(1.1);
            }
            
            .delete-button svg {
                width: 16px;
                height: 16px;
                fill: none;
                stroke: white;
                stroke-width: 2;
                stroke-linecap: round;
                stroke-linejoin: round;
            }
            
            .delete-button:hover svg {
                stroke: white;
            }
            
            /* Ê®°ÊÄÅÊ°ÜÊåâÈíÆÊ†∑Âºè‰ºòÂåñ */
            .btn-danger {
                background-color: #e74c3c;
                color: white;
                transition: all 0.3s ease;
            }
            
            .btn-danger:hover {
                background-color: #c0392b;
                transform: scale(1.05);
            }
            
            /* Á°ÆËÆ§Âà†Èô§ÂØπËØùÊ°ÜÊ†∑Âºè */
            .delete-confirm-section {
                text-align: center;
                padding: 20px;
            }
            
            .delete-confirm-section h3 {
                color: #e74c3c;
                margin-bottom: 15px;
            }
            
            .confirm-actions {
                margin-top: 20px;
                display: flex;
                justify-content: center;
                gap: 15px;
            }
            
            /* ÊîπËøõÁöÑÁ°ÆËÆ§Âà†Èô§ÂØπËØùÊ°Ü */
            #deleteConfirmModal {
                background-color: rgb(30, 30, 30);
                border: 2px solid #e74c3c;
                box-shadow: 0 5px 30px rgba(231, 76, 60, 0.7);
                border-radius: 8px;
                overflow: hidden;
            }
            
            .delete-confirmation-container {
                padding: 25px;
                text-align: center;
            }
            
            .delete-icon {
                font-size: 48px;
                color: #e74c3c;
                margin-bottom: 15px;
            }
            
            .delete-title {
                font-size: 24px;
                color: #e74c3c;
                margin-bottom: 15px;
                font-weight: 600;
            }
            
            .delete-message {
                font-size: 16px;
                color: #ffffff;
                margin-bottom: 25px;
                line-height: 1.5;
            }
            
            .delete-buttons {
                display: flex;
                justify-content: center;
                gap: 15px;
            }
            
            .delete-cancel-btn {
                padding: 10px 20px;
                background-color: rgba(255, 255, 255, 0.2);
                color: white;
                border: none;
                border-radius: 4px;
                font-size: 16px;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .delete-cancel-btn:hover {
                background-color: rgba(255, 255, 255, 0.3);
            }
            
            .delete-confirm-btn {
                padding: 10px 20px;
                background-color: #e74c3c;
                color: white;
                border: none;
                border-radius: 4px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .delete-confirm-btn:hover {
                background-color: #c0392b;
                transform: scale(1.05);
            }
            
            /* Ëá™ÂÆö‰πâË¶ÜÁõñÂ±Ç */
            .modal-backdrop {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(255, 241, 242, 0.8); // Ê∑°Á≤âËâ≤ËÉåÊôØ
                backdrop-filter: blur(5px);
                z-index: 999;
                display: none;
            }
            
            .modal-backdrop.active {
                display: block;
            }
            
            /* ÈöêËóèÂàÜÈ°µÊéß‰ª∂ */
            .journal-pagination {
                display: none !important;
            }
            
            /* ËøõÂ∫¶ÁºñËæëÊåâÈíÆÊ†∑Âºè */
            .progress-edit-btn, .progress-edit-btn-card {
                background: transparent;
                border: none;
                cursor: pointer;
                font-size: 14px;
                opacity: 0.7;
                transition: all 0.3s ease;
                padding: 0;
                margin-left: 8px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
            
            .progress-edit-btn:hover, .progress-edit-btn-card:hover {
                opacity: 1;
                transform: scale(1.2);
            }
            
            .progress-edit-btn-card {
                font-size: 12px;
            }
            
            /* ËøõÂ∫¶ÊªëÂùóÊ†∑Âºè */
            #progressSlider {
                -webkit-appearance: none;
                appearance: none;
                height: 10px;
                background: #ddd;
                border-radius: 5px;
                outline: none;
            }
            
            #progressSlider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 20px;
                height: 20px;
                background: #a2977e;
                border-radius: 50%;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            
            #progressSlider::-webkit-slider-thumb:hover {
                background: #8a816c;
                transform: scale(1.1);
            }
            
            #progressSlider::-moz-range-thumb {
                width: 20px;
                height: 20px;
                background: #a2977e;
                border-radius: 50%;
                cursor: pointer;
                border: none;
                transition: all 0.2s ease;
            }
            
            #progressSlider::-moz-range-thumb:hover {
                background: #8a816c;
                transform: scale(1.1);
            }
        `;
        document.head.appendChild(style);
        
        // Â≠òÂÇ®ÊâÄÊúâÊâæÂà∞ÁöÑÊîªÁï•
        let realGuides = [];
        
        // Êâ´ÊèèÊâÄÊúâlocalStorageÊü•ÊâæÊîªÁï•Êï∞ÊçÆ
        function scanForRealGuides() {
            // Êâ´ÊèèÊâÄÊúâlocalStorageÈîÆ
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                try {
                    const value = localStorage.getItem(key);
                    
                    // Â∞ùËØïËß£ÊûêJSON
                    try {
                        const parsedData = JSON.parse(value);
                        
                        // Ê£ÄÊü•ÊòØÂê¶ÊòØÊîªÁï•Êï∞ÁªÑ
                        if (Array.isArray(parsedData)) {
                            parsedData.forEach(item => {
                                if ((item.destination || item.title) && 
                                    (item.highlights || item.dailyPlan || item.duration)) {
                                    // ÊâæÂà∞‰∏Ä‰∏™ÊîªÁï•
                                    if (!realGuides.some(g => g.id === item.id)) {
                                        realGuides.push(item);
                                    }
                                }
                            });
                        } 
                        // Ê£ÄÊü•Âçï‰∏™ÊîªÁï•ÂØπË±°
                        else if (typeof parsedData === 'object' && 
                                (parsedData.destination || parsedData.title) && 
                                (parsedData.highlights || parsedData.dailyPlan || parsedData.duration)) {
                            if (!realGuides.some(g => g.id === parsedData.id)) {
                                realGuides.push(parsedData);
                            }
                        }
                    } catch (e) {
                        // ‰∏çÊòØJSONÔºåÂøΩÁï•
                    }
                } catch (e) {
                    console.error('ËØªÂèñlocalStorageÈîÆÊó∂Âá∫Èîô:', key, e);
                }
            }
            
            // ËøáÊª§ÊéâËá™Âä®ÁîüÊàêÁöÑÈªòËÆ§ÊîªÁï•
            realGuides = filterOutDefaultGuides(realGuides);
            
            // ‰øùÂ≠òÊâæÂà∞ÁöÑÊîªÁï•
            if (realGuides.length > 0) {
                console.log('ÊâæÂà∞', realGuides.length, '‰∏™ÁúüÂÆûÊîªÁï•');
                localStorage.setItem('savedGuides', JSON.stringify(realGuides));
                
                // Á´ãÂç≥ÊòæÁ§∫ÊîªÁï•
                displayRealGuides();
            } else {
                console.log('Êú™ÊâæÂà∞‰ªª‰ΩïÁúüÂÆûÊîªÁï•');
            }
        }
        
        // ËøáÊª§ÊéâËá™Âä®ÁîüÊàêÁöÑÈªòËÆ§ÊîªÁï•
        function filterOutDefaultGuides(guides) {
            return guides.filter(guide => {
                // ËøáÊª§ÊéâID‰∏∫1001Âíå1002ÁöÑÈªòËÆ§ÊîªÁï•
                if (guide.id === 1001 || guide.id === 1002) {
                    return false;
                }
                
                // ËøáÊª§ÊéâÂåÖÂê´"Ëá™Âä®ÂàõÂª∫ÁöÑÈªòËÆ§ÊóÖË°åËÆ°Âàí"Â§áÊ≥®ÁöÑÊîªÁï•
                if (guide.notes && guide.notes.includes('Ëá™Âä®ÂàõÂª∫ÁöÑÈªòËÆ§ÊóÖË°åËÆ°Âàí')) {
                    return false;
                }
                
                // ËøáÊª§ÊéâÈªòËÆ§ÁõÆÁöÑÂú∞ÁöÑÊîªÁï• (‰∫¨ÈÉΩ‰πãÊóÖ„ÄÅÂ∑¥Èªé‰πãÊóÖ)
                if ((guide.title === '‰∫¨ÈÉΩ‰πãÊóÖ' && guide.destination === '‰∫¨ÈÉΩÔºåÊó•Êú¨') || 
                    (guide.title === 'Â∑¥Èªé‰πãÊóÖ' && guide.destination === 'Â∑¥ÈªéÔºåÊ≥ïÂõΩ')) {
                    return false;
                }
                
                // ‰øùÁïôÁúüÂÆûÊîªÁï•
                return true;
            });
        }
        
        // ÊòæÁ§∫ÊâæÂà∞ÁöÑÁúüÂÆûÊîªÁï•
        function displayRealGuides() {
            if (realGuides.length === 0) return;
            
            // Ëé∑ÂèñÂÆπÂô®ÂÖÉÁ¥†
            const plansContainer = document.querySelector('.plans-container');
            if (!plansContainer) return;
            
            // ÂàõÂª∫HTML
            let plansHTML = '';
            
            // ÊòæÁ§∫ÊâÄÊúâÊîªÁï•Ôºå‰∏çÂàÜÈ°µ
            realGuides.forEach(guide => {
                // ÂàõÂª∫ÊòæÁ§∫Êó•Êúü
                const today = new Date();
                const startDate = new Date(today);
                startDate.setDate(today.getDate() + 30);
                const endDate = new Date(startDate);
                const duration = parseInt(guide.duration) || 7;
                endDate.setDate(startDate.getDate() + duration);
                
                const formattedStartDate = startDate.toLocaleDateString('en-US', { 
                    year: 'numeric', month: 'short', day: 'numeric' 
                });
                const formattedEndDate = endDate.toLocaleDateString('en-US', {
                    year: 'numeric', month: 'short', day: 'numeric'
                });
                
                // ‰ΩøÁî®Ëá™ÂÆö‰πâËøõÂ∫¶Êàñ‰ªélocalStorageËé∑ÂèñÁöÑËøõÂ∫¶
                let completionPercentage;
                
                // Â¶ÇÊûúÊîªÁï•ÊúâËá™ÂÆö‰πâËøõÂ∫¶ÔºåÁõ¥Êé•‰ΩøÁî®
                if (guide.customProgress !== undefined) {
                    completionPercentage = guide.customProgress;
                } else {
                    // ÈªòËÆ§ÁöÑÂü∫Á°ÄËøõÂ∫¶
                    completionPercentage = 25; 
                    
                    // ‰øùÂ≠òÈªòËÆ§ËøõÂ∫¶Âà∞localStorageÔºå‰ª•‰æøÂêéÁª≠ÂêåÊ≠•
                    if (!guide.customProgress) {
                        // Ê∑ªÂä†Âà∞guideÂØπË±°
                        guide.customProgress = completionPercentage;
                        
                        // ‰øùÂ≠òÂà∞localStorage
                        let savedGuides = JSON.parse(localStorage.getItem('savedGuides') || '[]');
                        const guideIndex = savedGuides.findIndex(g => g.id == guide.id);
                        if (guideIndex !== -1) {
                            savedGuides[guideIndex].customProgress = completionPercentage;
                            localStorage.setItem('savedGuides', JSON.stringify(savedGuides));
                        }
                    }
                }
                
                plansHTML += `
                    <div class="plan-card" data-plan-id="${guide.id}">
                        <div class="plan-header">
                            <h3>${guide.title || guide.destination} <span class="plan-badge">My Guide</span></h3>
                            <div class="plan-dates">${formattedStartDate} - ${formattedEndDate}</div>
                        </div>
                        <div class="plan-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${completionPercentage}%"></div>
                            </div>
                            <div class="progress-text">${completionPercentage}% ready</div>
                        </div>
                        <button class="delete-button" data-plan-id="${guide.id}" title="Âà†Èô§ÊîªÁï•">
                            <svg viewBox="0 0 24 24">
                                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"></path>
                            </svg>
                        </button>
                    </div>
                `;
            });
            
            // ÊòæÁ§∫ÊîªÁï•
            plansContainer.innerHTML = plansHTML;
            
            // ‰∏∫ÊØè‰∏™Âà†Èô§ÊåâÈíÆÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨
            document.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // ÈòªÊ≠¢‰∫ã‰ª∂ÂÜíÊ≥°ÔºåÈÅøÂÖçËß¶ÂèëÂç°ÁâáÁÇπÂáª
                    const planId = this.dataset.planId;
                    console.log('Âà†Èô§ÊåâÈíÆË¢´ÁÇπÂáªÔºåÊîªÁï•ID=', planId);
                    
                    const guide = realGuides.find(g => g.id == planId);
                    if (guide) {
                        console.log('ÊâæÂà∞Ë¶ÅÂà†Èô§ÁöÑÊîªÁï•:', guide.title || guide.destination);
                        showDeleteConfirmation(guide);
                    } else {
                        console.error('Êú™ÊâæÂà∞Ë¶ÅÂà†Èô§ÁöÑÊîªÁï•ÔºåID=', planId);
                    }
                });
            });
            
            // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂Â§ÑÁêÜ
            const planCards = document.querySelectorAll('.plan-card');
            planCards.forEach(card => {
                card.addEventListener('click', function() {
                    // ÁßªÈô§ÊâÄÊúâÂç°ÁâáÁöÑactiveÁ±ª
                    planCards.forEach(c => c.classList.remove('active'));
                    
                    // ‰∏∫ÂΩìÂâçÂç°ÁâáÊ∑ªÂä†activeÁ±ª
                    this.classList.add('active');
                    
                    // Ëé∑ÂèñËÆ°ÂàíIDÂπ∂ÊòæÁ§∫ËØ¶ÊÉÖ
                    const planId = this.dataset.planId;
                    const guide = realGuides.find(g => g.id == planId);
                    
                    if (guide) {
                        displayPlanDetails(guide);
                    }
                });
            });
            
            // ÈªòËÆ§ÈÄâÊã©Á¨¨‰∏Ä‰∏™ÊîªÁï•
            if (planCards.length > 0) {
                planCards[0].click();
            }
            
            // ÂàùÂßãÂåñËøõÂ∫¶ÁºñËæëÂäüËÉΩ
            if (window.progressEditor && typeof window.progressEditor.init === 'function') {
                window.progressEditor.init();
            }
            
            // Ëß¶ÂèëËÆ°ÂàíÊòæÁ§∫‰∫ã‰ª∂ÔºåÁ°Æ‰øùËøõÂ∫¶ÂêåÊ≠•
            document.dispatchEvent(new CustomEvent('plansDisplayed'));
        }
        
        // ÊòæÁ§∫ÊîªÁï•ËØ¶ÊÉÖ
        function displayPlanDetails(guide) {
            const detailsContainer = document.querySelector('.plan-details-content');
            if (!detailsContainer) return;
            
            // ÂàõÂª∫Êó•Êúü
            const today = new Date();
            const startDate = new Date(today);
            startDate.setDate(today.getDate() + 30);
            const endDate = new Date(startDate);
            const duration = parseInt(guide.duration) || 7;
            endDate.setDate(startDate.getDate() + duration);
            
            const formattedStartDate = startDate.toLocaleDateString('en-US', { 
                year: 'numeric', month: 'short', day: 'numeric' 
            });
            const formattedEndDate = endDate.toLocaleDateString('en-US', {
                year: 'numeric', month: 'short', day: 'numeric'
            });
            
            // ËÆ°ÁÆóË∑ùÁ¶ªÊóÖË°åÁöÑÂ§©Êï∞
            const daysUntil = 30; // ÈªòËÆ§30Â§©
            const daysUntilText = `${daysUntil} days until your trip`;
            
            // ‰∏∫ÊØè‰∏™ÊîªÁï•Âä®ÊÄÅÁîüÊàê‰ªªÂä°
            const tasks = [
                { id: guide.id + '1', text: 'Book flight', completed: false },
                { id: guide.id + '2', text: 'Reserve accommodation', completed: false },
                { id: guide.id + '3', text: 'Plan daily activities', completed: true }
            ];
            
            // Âü∫‰∫éÊîªÁï•ÂÜÖÂÆπÊ∑ªÂä†ÁâπÂÆö‰ªªÂä°
            if (guide.highlights && guide.highlights.length > 3) {
                tasks.push({ id: guide.id + '4', text: 'Research attractions', completed: true });
            }
            
            if (guide.dailyPlan && guide.dailyPlan.length > 0) {
                tasks.push({ id: guide.id + '5', text: 'Finalize itinerary', completed: guide.dailyPlan.length > 3 });
            }
            
            // Âü∫‰∫éIDÂÜ≥ÂÆöÊüê‰∫õ‰ªªÂä°ÁöÑÂÆåÊàêÁä∂ÊÄÅÔºåÁ°Æ‰øùÊØè‰∏™ÊîªÁï•ÊúâÁã¨ÁâπËøõÂ∫¶
            const guideSeed = parseInt(String(guide.id).slice(-2)) || 0;
            if (guideSeed % 2 === 0) {
                tasks[0].completed = true; // ÂÅ∂Êï∞IDÁöÑÊîªÁï•Â∑≤È¢ÑËÆ¢Ëà™Áè≠
            }
            
            if (guideSeed % 3 === 0) {
                tasks[1].completed = true; // ËÉΩË¢´3Êï¥Èô§ÁöÑIDÁöÑÊîªÁï•Â∑≤È¢ÑËÆ¢‰ΩèÂÆø
            }
            
            // ÂÜçÊ∑ªÂä†‰∏§‰∏™‰ªªÂä°
            tasks.push({ id: guide.id + '6', text: 'Pack luggage', completed: false });
            tasks.push({ id: guide.id + '7', text: 'Exchange currency', completed: guideSeed % 5 === 0 });
            
            // Ëé∑ÂèñÂÆåÊàêËøõÂ∫¶ÔºàËá™ÂÆö‰πâÊàñÂü∫‰∫é‰ªªÂä°ËÆ°ÁÆóÔºâ
            let completionPercentage;
            
            // Â¶ÇÊûúÊúâËá™ÂÆö‰πâËøõÂ∫¶Ôºå‰ΩøÁî®ÂÆÉ
            if (guide.customProgress !== undefined) {
                completionPercentage = guide.customProgress;
            } else {
                // ËÆ°ÁÆóÂü∫‰∫é‰ªªÂä°ÁöÑËøõÂ∫¶
                const completedTasks = tasks.filter(t => t.completed).length;
                completionPercentage = Math.round((completedTasks / tasks.length) * 100);
            }
            
            // ÂàõÂª∫HTML
            let detailsHTML = `
                <div class="plan-details">
                    <div class="plan-details-header">
                        <h2>${guide.title || guide.destination}</h2>
                        <div class="plan-details-dates">${formattedStartDate} - ${formattedEndDate}</div>
                        <div class="plan-details-countdown">${daysUntilText}</div>
                    </div>
                    <div class="plan-details-body">
                        <div class="plan-details-section">
                            <h3>ÂáÜÂ§áËøõÂ∫¶</h3>
                            <div class="plan-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${completionPercentage}%"></div>
                                </div>
                                <div class="progress-text">${completionPercentage}% complete</div>
                            </div>
                        </div>
                        <div class="plan-details-section">
                            <h3>ÂáÜÂ§á‰ªªÂä°</h3>
                            <ul class="task-list">
            `;
            
            // Ê∑ªÂä†‰ªªÂä°
            tasks.forEach(task => {
                detailsHTML += `
                    <li class="task-item ${task.completed ? 'completed' : ''}">
                        <label class="task-checkbox">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} data-task-id="${task.id}">
                            <span class="checkmark"></span>
                        </label>
                        <span class="task-text">${task.text}</span>
                    </li>
                `;
            });
            
            // Ê∑ªÂä†ÊîªÁï•‰ø°ÊÅØ
            detailsHTML += `
                            </ul>
                        </div>
                        <div class="plan-details-section">
                            <h3>ÊóÖË°åÊåáÂçó</h3>
                            <div class="guide-overview">
                                <p>${guide.overview || '‰∏∫ÊÇ®ÂÆöÂà∂ÁöÑ‰∏ìÂ±ûÊóÖË°åËÆ°Âàí'}</p>
                            </div>
            `;
            
            // Ê∑ªÂä†‰∫ÆÁÇπ
            if (guide.highlights && guide.highlights.length > 0) {
                detailsHTML += `
                    <div class="guide-highlights">
                        <h4>Ë°åÁ®ã‰∫ÆÁÇπ</h4>
                        <ul>
                `;
                
                guide.highlights.forEach(highlight => {
                    detailsHTML += `<li>${highlight}</li>`;
                });
                
                detailsHTML += `
                        </ul>
                    </div>
                `;
            }
            
            // ÂÆåÊàêHTML
            detailsHTML += `
                            <button class="btn btn-small btn-highlight view-full-guide" data-plan-id="${guide.id}">Êü•ÁúãÂÆåÊï¥ÊîªÁï•</button>
                            <button class="btn btn-small btn-danger delete-guide" data-plan-id="${guide.id}">Âà†Èô§ÊîªÁï•</button>
                        </div>
                    </div>
                </div>
            `;
            
            // ÊòæÁ§∫ËØ¶ÊÉÖ
            detailsContainer.innerHTML = detailsHTML;
            
            // Ê∑ªÂä†Êü•ÁúãÂÆåÊï¥ÊîªÁï•ÊåâÈíÆ‰∫ã‰ª∂
            document.querySelector('.view-full-guide').addEventListener('click', function() {
                showTravelGuideDetails(guide);
            });
            
            // Ê∑ªÂä†Âà†Èô§ÊîªÁï•ÊåâÈíÆ‰∫ã‰ª∂
            document.querySelector('.delete-guide').addEventListener('click', function() {
                showDeleteConfirmation(guide);
            });
            
            // ÂàùÂßãÂåñËøõÂ∫¶ÁºñËæëÂäüËÉΩ
            if (window.progressEditor && typeof window.progressEditor.init === 'function') {
                setTimeout(() => {
                    window.progressEditor.init();
                    
                    // Ëß¶ÂèëËÆ°ÂàíÊòæÁ§∫‰∫ã‰ª∂ÔºåÁ°Æ‰øùËøõÂ∫¶ÂêåÊ≠•
                    document.dispatchEvent(new CustomEvent('plansDisplayed'));
                }, 100);
            }
        }
        
        // ÊòæÁ§∫ÂÆåÊï¥ÊóÖË°åÊîªÁï•
        function showTravelGuideDetails(guide) {
            const modal = document.querySelector('.travel-guide-modal');
            const overlay = document.querySelector('.travel-guide-overlay');
            const container = document.querySelector('.travel-guide-container');
            const title = document.querySelector('.travel-guide-title');
            
            if (!modal || !overlay || !container) return;
            
            // ËÆæÁΩÆÊ†áÈ¢ò
            title.textContent = guide.title || guide.destination;
            
            // ÂàõÂª∫ÂÜÖÂÆπHTML
            let guideHTML = `
                <div class="guide-section guide-destination">
                    <h3>${guide.destination}</h3>
                    <p>${guide.overview || '‰∏∫ÊÇ®ÂÆöÂà∂ÁöÑ‰∏ìÂ±ûÊóÖË°åËÆ°Âàí'}</p>
                </div>
            `;
            
            // Ê∑ªÂä†‰∫ÆÁÇπ
            if (guide.highlights && guide.highlights.length > 0) {
                guideHTML += `
                    <div class="guide-section guide-highlights">
                        <h4>Ë°åÁ®ã‰∫ÆÁÇπ</h4>
                        <ul>
                `;
                
                guide.highlights.forEach(highlight => {
                    guideHTML += `<li>${highlight}</li>`;
                });
                
                guideHTML += `
                        </ul>
                    </div>
                `;
            }
            
            // Ê∑ªÂä†ÊØèÊó•ËÆ°Âàí
            if (guide.dailyPlan && guide.dailyPlan.length > 0) {
                guideHTML += `
                    <div class="guide-section guide-daily-plan">
                        <h4>ÊØèÊó•Ë°åÁ®ã</h4>
                        <div class="guide-daily-plan-container">
                `;
                
                guide.dailyPlan.forEach(day => {
                    guideHTML += `
                        <div class="guide-day-card">
                            <div class="guide-day-number">Á¨¨ ${day.day} Â§©</div>
                            <div class="guide-day-details">
                                <h5>${day.activity}</h5>
                                <p class="day-location">${day.location}</p>
                            </div>
                        </div>
                    `;
                });
                
                guideHTML += `
                        </div>
                    </div>
                `;
            }
            
            // Ê∑ªÂä†Â§áÊ≥®
            if (guide.notes) {
                guideHTML += `
                    <div class="guide-section guide-notes">
                        <h4>ÊóÖË°åÂ§áÊ≥®</h4>
                        <p>${guide.notes}</p>
                    </div>
                `;
            }
            
            // Ê∑ªÂä†ÂáÜÂ§áËøõÂ∫¶‰ø°ÊÅØ
            const completionPercentage = guide.customProgress !== undefined ? 
                guide.customProgress : 
                Math.round(Math.random() * 50) + 25; // Â¶ÇÊûúÊ≤°ÊúâËá™ÂÆö‰πâËøõÂ∫¶ÔºåÁîüÊàêÈöèÊú∫ËøõÂ∫¶
            
            guideHTML += `
                <div class="guide-section guide-progress">
                    <h4>ÂáÜÂ§áËøõÂ∫¶</h4>
                    <div class="plan-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${completionPercentage}%"></div>
                        </div>
                        <div class="progress-text">${completionPercentage}% complete</div>
                    </div>
                </div>
            `;
            
            // Ê∑ªÂä†Âà†Èô§ÊåâÈíÆ
            guideHTML += `
                <div class="guide-section guide-actions">
                    <button class="btn btn-danger delete-guide-from-modal" data-plan-id="${guide.id}">Âà†Èô§ÊîªÁï•</button>
                </div>
            `;
            
            // ÊòæÁ§∫ÂÜÖÂÆπ
            container.innerHTML = guideHTML;
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            modal.classList.add('active');
            overlay.classList.add('active');
            
            // Ê∑ªÂä†ÂÖ≥Èó≠ÊåâÈíÆ‰∫ã‰ª∂
            document.querySelector('.travel-guide-close').addEventListener('click', function() {
                modal.classList.remove('active');
                overlay.classList.remove('active');
            });
            
            // Ê∑ªÂä†Âà†Èô§ÊåâÈíÆ‰∫ã‰ª∂
            document.querySelector('.delete-guide-from-modal').addEventListener('click', function() {
                modal.classList.remove('active');
                overlay.classList.remove('active');
                showDeleteConfirmation(guide);
            });
            
            // ÂàùÂßãÂåñËøõÂ∫¶ÁºñËæëÂäüËÉΩ
            if (window.progressEditor && typeof window.progressEditor.init === 'function') {
                setTimeout(() => {
                    window.progressEditor.init();
                }, 100);
            }
        }
        
        // ÊòæÁ§∫Âà†Èô§Á°ÆËÆ§ÂØπËØùÊ°Ü
        function showDeleteConfirmation(guide) {
            console.log('ÊòæÁ§∫Âà†Èô§Á°ÆËÆ§ÂØπËØùÊ°ÜÔºåÊîªÁï•ID=', guide.id);
            
            // ÁßªÈô§‰ªª‰ΩïÁé∞ÊúâÁöÑÁ°ÆËÆ§ÂØπËØùÊ°Ü
            const existingModal = document.getElementById('deleteConfirmModal');
            if (existingModal) {
                document.body.removeChild(existingModal);
            }
            
            const existingBackdrop = document.querySelector('.modal-backdrop');
            if (existingBackdrop) {
                document.body.removeChild(existingBackdrop);
            }
            
            // ÂàõÂª∫Êñ∞ÁöÑËÉåÊôØË¶ÜÁõñÂ±Ç
            const backdrop = document.createElement('div');
            backdrop.className = 'modal-backdrop';
            backdrop.style.position = 'fixed';
            backdrop.style.top = '0';
            backdrop.style.left = '0';
            backdrop.style.width = '100%';
            backdrop.style.height = '100%';
            backdrop.style.backgroundColor = 'rgba(255, 241, 242, 0.8)'; // Ê∑°Á≤âËâ≤ËÉåÊôØ
            backdrop.style.backdropFilter = 'blur(5px)';
            backdrop.style.zIndex = '999';
            document.body.appendChild(backdrop);
            
            // ÂàõÂª∫Êñ∞ÁöÑÁ°ÆËÆ§ÂØπËØùÊ°Ü
            const modal = document.createElement('div');
            modal.id = 'deleteConfirmModal';
            modal.style.position = 'fixed';
            modal.style.top = '50%';
            modal.style.left = '50%';
            modal.style.transform = 'translate(-50%, -50%)';
            modal.style.backgroundColor = '#fff5f7'; // Ê∑°Á≤âËâ≤ËÉåÊôØ
            modal.style.border = '3px solid #f8a5c2'; // Á≤âËâ≤ËæπÊ°Ü
            modal.style.boxShadow = '0 5px 30px rgba(248, 165, 194, 0.5)'; // Á≤âËâ≤Èò¥ÂΩ±
            modal.style.borderRadius = '18px'; // Êõ¥ÂúÜÊ∂¶ÁöÑËæπËßí
            modal.style.padding = '30px';
            modal.style.width = '400px';
            modal.style.maxWidth = '90%';
            modal.style.textAlign = 'center';
            modal.style.zIndex = '1000';
            
            // ÂàõÂª∫ÂÜÖÂÆπ
            const icon = document.createElement('div');
            icon.style.fontSize = '52px';
            icon.style.marginBottom = '15px';
            icon.textContent = 'üóëÔ∏è';
            
            const title = document.createElement('h2');
            title.style.fontSize = '26px';
            title.style.color = '#e17b9d'; // Ê∑±Á≤âËâ≤ÊñáÂ≠ó
            title.style.marginBottom = '15px';
            title.style.fontWeight = '600';
            title.textContent = 'Á°ÆËÆ§Âà†Èô§';
            
            const message = document.createElement('p');
            message.style.fontSize = '16px';
            message.style.color = '#7b5d6f'; // ÁÅ∞Á¥´Ëâ≤ÊñáÂ≠ó
            message.style.marginBottom = '25px';
            message.style.lineHeight = '1.5';
            message.textContent = `ÊÇ®Á°ÆÂÆöË¶ÅÂà†Èô§ "${guide.title || guide.destination}" ÊîªÁï•ÂêóÔºüÊ≠§Êìç‰ΩúÂ∞ÜÊ∞∏‰πÖÂà†Èô§Ê≠§ÊîªÁï•ÔºåÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ`;
            
            const buttonsContainer = document.createElement('div');
            buttonsContainer.style.display = 'flex';
            buttonsContainer.style.justifyContent = 'center';
            buttonsContainer.style.gap = '15px';
            
            const cancelButton = document.createElement('button');
            cancelButton.style.padding = '12px 24px';
            cancelButton.style.backgroundColor = '#b6e2d3'; // ËñÑËç∑ÁªøÊåâÈíÆ
            cancelButton.style.color = '#2d6a4f';
            cancelButton.style.border = 'none';
            cancelButton.style.borderRadius = '50px'; // ÂÆåÂÖ®ÂúÜËßí
            cancelButton.style.fontSize = '16px';
            cancelButton.style.cursor = 'pointer';
            cancelButton.style.fontWeight = '600';
            cancelButton.style.transition = 'all 0.3s ease';
            cancelButton.textContent = 'ÂèñÊ∂à';
            
            // Ê∑ªÂä†ÊÇ¨ÂÅúÊïàÊûú
            cancelButton.onmouseover = function() {
                this.style.backgroundColor = '#8bd3bd';
                this.style.transform = 'scale(1.05)';
            };
            cancelButton.onmouseout = function() {
                this.style.backgroundColor = '#b6e2d3';
                this.style.transform = 'scale(1)';
            };
            
            const confirmButton = document.createElement('button');
            confirmButton.style.padding = '12px 24px';
            confirmButton.style.backgroundColor = '#ffc2c7'; // Ê∑°Á≤âËâ≤ÊåâÈíÆ
            confirmButton.style.color = '#c9184a'; // Ê∑±Á∫¢Ëâ≤ÊñáÂ≠ó
            confirmButton.style.border = 'none';
            confirmButton.style.borderRadius = '50px'; // ÂÆåÂÖ®ÂúÜËßí
            confirmButton.style.fontSize = '16px';
            confirmButton.style.fontWeight = '600';
            confirmButton.style.cursor = 'pointer';
            confirmButton.style.transition = 'all 0.3s ease';
            confirmButton.textContent = 'Á°ÆËÆ§Âà†Èô§';
            
            // Ê∑ªÂä†ÊÇ¨ÂÅúÊïàÊûú
            confirmButton.onmouseover = function() {
                this.style.backgroundColor = '#ffadb5';
                this.style.transform = 'scale(1.05)';
            };
            confirmButton.onmouseout = function() {
                this.style.backgroundColor = '#ffc2c7';
                this.style.transform = 'scale(1)';
            };
            
            // Ê∑ªÂä†‰∫ã‰ª∂
            cancelButton.addEventListener('click', function() {
                document.body.removeChild(backdrop);
                document.body.removeChild(modal);
                document.body.style.overflow = '';
            });
            
            confirmButton.addEventListener('click', function() {
                forceDeleteGuide(guide.id);
                document.body.removeChild(backdrop);
                document.body.removeChild(modal);
                document.body.style.overflow = '';
            });
            
            // ÁªÑË£ÖÂØπËØùÊ°Ü
            buttonsContainer.appendChild(cancelButton);
            buttonsContainer.appendChild(confirmButton);
            
            modal.appendChild(icon);
            modal.appendChild(title);
            modal.appendChild(message);
            modal.appendChild(buttonsContainer);
            
            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.appendChild(modal);
            
            // Á¶ÅÊ≠¢ËÉåÊôØÊªöÂä®
            document.body.style.overflow = 'hidden';
        }
        
        // Âº∫Âà∂ÂΩªÂ∫ïÂà†Èô§ÊîªÁï•
        function forceDeleteGuide(planId) {
            console.log(`ÂºÄÂßãÂº∫Âà∂Âà†Èô§ÊîªÁï•ID=${planId}`);
            
            // ‰ªéÂÜÖÂ≠òÊï∞ÁªÑ‰∏≠ÁßªÈô§ÊîªÁï•
            realGuides = realGuides.filter(guide => guide.id != planId);
            
            // Ê∏ÖÁêÜÊâÄÊúâlocalStorage
            clearGuideFromAllStorage(planId);
            
            // ÈáçÊñ∞ÊòæÁ§∫ÊîªÁï•ÂàóË°®
            displayRealGuides();
            
            // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
            showDeleteSuccessMessage();
        }
        
        // ‰ªéÊâÄÊúâÂèØËÉΩÁöÑÂ≠òÂÇ®‰ΩçÁΩÆÂΩªÂ∫ïÊ∏ÖÈô§ÊîªÁï•
        function clearGuideFromAllStorage(planId) {
            // Â≠òÂÇ®Â∑≤Â§ÑÁêÜÁöÑÈîÆÔºåÈÅøÂÖçÂæ™ÁéØÂºïÁî®
            const processedKeys = new Set();
            
            // ÈÄíÂΩíÊ∏ÖÁêÜÂáΩÊï∞
            function recursiveClear() {
                let foundGuide = false;
                
                // È¶ñÂÖàÊõ¥Êñ∞ÂΩìÂâçÂ∑≤Áü•ÁöÑsavedGuides
                let savedGuides = JSON.parse(localStorage.getItem('savedGuides') || '[]');
                const originalLength = savedGuides.length;
                savedGuides = savedGuides.filter(guide => guide.id != planId);
                if (savedGuides.length !== originalLength) {
                    localStorage.setItem('savedGuides', JSON.stringify(savedGuides));
                    foundGuide = true;
                    console.log(`‰ªésavedGuides‰∏≠Âà†Èô§‰∫ÜÊîªÁï•ID=${planId}`);
                }
                
                // Ê£ÄÊü•ÊâÄÊúâlocalStorageÈîÆ
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (processedKeys.has(key)) continue;
                    
                    processedKeys.add(key);
                    try {
                        const value = localStorage.getItem(key);
                        if (!value) continue;
                        
                        // Ê£ÄÊü•ÊòØÂê¶Áõ¥Êé•ÂåÖÂê´ÊîªÁï•ID
                        if (value.includes(`"id":${planId}`) || value.includes(`"id": ${planId}`)) {
                            try {
                                const data = JSON.parse(value);
                                let modified = false;
                                
                                // Â§ÑÁêÜÊï∞ÁªÑ
                                if (Array.isArray(data)) {
                                    const newData = data.filter(item => {
                                        if (!item || typeof item !== 'object') return true;
                                        return item.id != planId;
                                    });
                                    
                                    if (newData.length !== data.length) {
                                        localStorage.setItem(key, JSON.stringify(newData));
                                        modified = true;
                                        foundGuide = true;
                                    }
                                }
                                // Â§ÑÁêÜÂØπË±°
                                else if (data && typeof data === 'object') {
                                    // Â¶ÇÊûúÂØπË±°Êú¨Ë∫´ÊòØÊîªÁï•
                                    if (data.id == planId) {
                                        localStorage.removeItem(key);
                                        modified = true;
                                        foundGuide = true;
                                    } 
                                    // Ê£ÄÊü•ÂØπË±°ÁöÑÊâÄÊúâÂ±ûÊÄß
                                    else {
                                        for (const prop in data) {
                                            // Â¶ÇÊûúÂ±ûÊÄßÊòØÊï∞ÁªÑ
                                            if (Array.isArray(data[prop])) {
                                                const originalLength = data[prop].length;
                                                data[prop] = data[prop].filter(item => {
                                                    if (!item || typeof item !== 'object') return true;
                                                    return item.id != planId;
                                                });
                                                
                                                if (data[prop].length !== originalLength) {
                                                    localStorage.setItem(key, JSON.stringify(data));
                                                    modified = true;
                                                    foundGuide = true;
                                                }
                                            }
                                            // Â¶ÇÊûúÂ±ûÊÄßÊòØÂØπË±°‰∏îÂåÖÂê´ID
                                            else if (data[prop] && typeof data[prop] === 'object' && data[prop].id == planId) {
                                                delete data[prop];
                                                localStorage.setItem(key, JSON.stringify(data));
                                                modified = true;
                                                foundGuide = true;
                                            }
                                        }
                                    }
                                }
                                
                                if (modified) {
                                    console.log(`‰ªélocalStorageÈîÆ "${key}" ‰∏≠ÂΩªÂ∫ïÊ∏ÖÈô§‰∫ÜÊîªÁï•`);
                                }
                            } catch (e) {
                                console.log(`Â∞ùËØïËß£ÊûêÈîÆ "${key}" Êó∂Âá∫Èîô:`, e);
                            }
                        }
                    } catch (e) {
                        console.error(`Â§ÑÁêÜlocalStorageÈîÆ "${key}" Êó∂Âá∫Èîô:`, e);
                    }
                }
                
                // Â¶ÇÊûúÊâæÂà∞Âπ∂Ê∏ÖÈô§‰∫ÜÊîªÁï•ÔºåÂÜçÊ¨°ËøêË°å‰ª•Á°Æ‰øùÂÆåÂÖ®Âà†Èô§
                return foundGuide;
            }
            
            // ËøêË°åÂ§öÊ¨°ÈÄíÂΩíÊ∏ÖÁêÜÔºåÁ°Æ‰øùÂΩªÂ∫ïÂà†Èô§
            let iteration = 0;
            let continueClearing = true;
            
            while (continueClearing && iteration < 5) {
                console.log(`Ê∏ÖÁêÜËø≠‰ª£ ${iteration + 1}`);
                continueClearing = recursiveClear();
                iteration++;
            }
            
            // ÊúÄÂêéÂÜçÊ¨°ÂÆåÂÖ®Ê∏ÖÈô§Â∑≤Áü•‰ΩçÁΩÆ
            localStorage.setItem('savedGuides', JSON.stringify(realGuides));
            
            console.log(`ÊîªÁï•ID=${planId} Â∑≤ÂΩªÂ∫ï‰ªéÊâÄÊúâÂ≠òÂÇ®‰∏≠Ê∏ÖÈô§`);
        }
        
        // ÊòæÁ§∫Âà†Èô§ÊàêÂäüÊ∂àÊÅØ
        function showDeleteSuccessMessage() {
            // ÂàõÂª∫Ê∂àÊÅØÂÖÉÁ¥†
            const message = document.createElement('div');
            message.className = 'message success';
            message.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">‚úÖ</span>
                    <span>ÊîªÁï•Â∑≤ÊàêÂäüÂà†Èô§ÔºÅ</span>
                </div>
            `;
            
            // ËÆæÁΩÆÊ†∑Âºè
            Object.assign(message.style, {
                position: 'fixed',
                top: '20px',
                left: '50%',
                transform: 'translateX(-50%)',
                backgroundColor: 'rgba(46, 204, 113, 0.95)',
                color: 'white',
                padding: '15px 25px',
                borderRadius: '5px',
                zIndex: '9999',
                boxShadow: '0 4px 15px rgba(0, 0, 0, 0.3)',
                fontWeight: 'bold',
                fontSize: '16px',
                border: '2px solid rgba(39, 174, 96, 0.8)'
            });
            
            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.appendChild(message);
            
            // 3ÁßíÂêéËá™Âä®ÁßªÈô§
            setTimeout(() => {
                // Ê∑ªÂä†Ê∑°Âá∫ÊïàÊûú
                message.style.transition = 'opacity 0.5s ease';
                message.style.opacity = '0';
                
                // ÂÆåÂÖ®ÁßªÈô§ÂÖÉÁ¥†
                setTimeout(() => {
                    if (document.body.contains(message)) {
                        document.body.removeChild(message);
                    }
                }, 500);
            }, 3000);
        }
        
        // Á´ãÂç≥ÊâßË°åÊâ´Êèè
        scanForRealGuides();
        
        // ‰∏∫Áé∞ÊúâÁöÑÂà†Èô§ÊåâÈíÆÊ∑ªÂä†‰∫ã‰ª∂
        document.getElementById('deleteGuideBtn').addEventListener('click', function() {
            const planId = document.querySelector('.edit-guide-modal').dataset.planId;
            const guide = realGuides.find(g => g.id == planId);
            if (guide) {
                showDeleteConfirmation(guide);
            }
        });
    })();
    </script>
</body>
</html> 